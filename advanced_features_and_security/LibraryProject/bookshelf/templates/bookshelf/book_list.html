<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">

    <title>Book List - Secure Search</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
        }
        .search-form {
            margin-bottom: 30px;
            padding: 20px;
            background-color: #f5f5f5;
            border-radius: 4px;
        }
        .search-form input {
            padding: 8px;
            width: 70%;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .search-form button {
            padding: 8px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .book-item {
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .book-title {
            font-weight: bold;
            font-size: 1.2em;
        }
        .book-author {
            color: #666;
        }
    </style>
</head>
<body>
    <h1>Library Books</h1>

    <!--
    SECURITY: Search Form with CSRF Protection
    Even though this is a GET request (search), including CSRF for consistency
    GET requests don't require CSRF, but POST/PUT/DELETE do
    -->
    <div class="search-form">
        <h2>Search Books</h2>
        <form method="get">
            {{ form.query }}
            <button type="submit">Search</button>
        </form>
    </div>

    <!-- Display Results -->
    <div class="results">
        <h2>Books ({{ books.count }})</h2>

        {% if books %}
            {% for book in books %}
                <div class="book-item">
                    <!--
                    SECURITY: Django auto-escapes variables to prevent XSS
                    {{ book.title }} is automatically escaped
                    Example: if title is "<script>alert('XSS')</script>"
                    It displays as text, not executed as code
                    -->
                    <div class="book-title">{{ book.title }}</div>
                    <div class="book-author">by {{ book.author }}</div>
                    <div class="book-year">Published: {{ book.publication_year }}</div>
                </div>
            {% endfor %}
        {% else %}
            <p>No books found.</p>
        {% endif %}
    </div>

    <!--
    SECURITY NOTES:
    1. Search uses Django ORM (prevents SQL injection)
    2. All output is auto-escaped (prevents XSS)
    3. Input validated through SearchForm
    4. GET used for search (idempotent operation)
    -->
</body>
</html>